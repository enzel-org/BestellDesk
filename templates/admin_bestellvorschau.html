<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Bestellvorschau</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin_bestellvorschau.css') }}">
</head>
<body>
    <h1>Bestellvorschau</h1>

    {% if vorschau %}
        <form method="post">
            <div class="vorschau-box">
                <label for="firma">Firma:</label>
                <select name="firma" id="firma">
                    {% for eintrag in firmen %}
                        <option value="{{ eintrag.name }}">{{ eintrag.name }}</option>
                    {% endfor %}
                </select><br><br>

                <label for="adresse">Lieferadresse:</label>
                <select name="adresse" id="adresse">
                    {% for eintrag in lieferadressen %}
                        <option value="{{ eintrag.adresse }}">{{ eintrag.adresse }}</option>
                    {% endfor %}
                </select><br><br>

                <label for="nachricht">Nachricht an Lieferanten:</label><br>
                <textarea name="nachricht" id="nachricht"></textarea>
            </div>
            <a id="whatsappLink" href="#" target="_blank" class="button">per WhatsApp Web senden</a>
        </form>
    {% else %}
        <p>Keine Bestellungen vorhanden.</p>
    {% endif %}

    <br>
    <a href="/admin">Zurück zum Adminbereich</a>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const firmaSelect = document.getElementById("firma");
        const adresseSelect = document.getElementById("adresse");
        const textarea = document.getElementById("nachricht");
        const whatsappLink = document.getElementById("whatsappLink");

        const bestellung = {{ vorschau | tojson }};
        const name = {{ zustaendig | tojson }};
        const nummer = {{ whatsapp_nummer | tojson }};

        function aktualisiereNachricht() {
            const firma = firmaSelect.value || "unsere Firma";
            const adresse = adresseSelect.value || "unbekannte Adresse";

            const text = `Guten Tag, hier ist die Firma ${firma}.
Mein Name ist ${name} und wir würden gerne Folgendes bestellen:\n
${bestellung}\n
Bitte liefern Sie an folgende Adresse: ${adresse}`;
            textarea.value = text;
            whatsappLink.href = `https://web.whatsapp.com/send?phone=${nummer}&text=` + encodeURIComponent(text);
        }

        aktualisiereNachricht();
        firmaSelect.addEventListener("change", aktualisiereNachricht);
        adresseSelect.addEventListener("change", aktualisiereNachricht);
    });
    </script>
</body>
</html>
